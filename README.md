# Claude Code Subagents でワークフローを回すためのテンプレート

## 概要

このリポジトリは、Claude Code のSubagentsで「ドキュメント駆動のワークフロー」を回すための最小構成テンプレートです。アプリ実装コードは含めず、ワークフロー運用に必要なプロンプト設定と進捗ドキュメントのみを提供します。

## 特徴

 - **ワークフローループを自動運用**: 1 ステップ実装 → レビュー → ドキュメント更新 → 次の計画 を自動ループ
- **プロンプトと設定の分離**: `.claude/` 配下にシステムプロンプトとサブエージェントの最小設定を格納
- **ドキュメント駆動**: `docs/plan.md` をベースにアプリケーションの実装を行います。
- **進捗管理**: `docs/context.md` を単一の情報源として進捗・要件を管理
- **トークン効率（メイン）**: メインエージェントのトークン消費を抑えやすく、auto-compact を回避しやすい設計です。
- **実行時間**: 1 回のリクエストで長時間動作します。
- **トークン消費（全体）**: サブエージェント連携により総消費は増える傾向があります。
- **コスト対効果**: 実行時間に対してのトークン消費は比較的抑えられるケースがあります。

## ディレクトリ構成

```
claude-code-agents-workflow/
  ├─ .claude/
  │   ├─ agents/
  │   │   ├─ planner.md     # 計画担当エージェントのプロンプト
  │   │   ├─ executor.md    # 実装担当エージェントのプロンプト
  │   │   └─ reviewer.md    # レビュー担当エージェントのプロンプト
  │   ├─ commands/
  │   │   └─ wf.md          # /wf コマンドの仕様・ループ手順
  │   └─ settings.json      # セッション開始/完了での簡易メッセージ設定
  └─ docs/
      ├─ context.md         # 現在の実装状況・レビュー・決定事項のログ（進捗台帳）
      └─ plan.md            # 設計方針・UML・ユースケース等の計画書
```

## 使い方（Claude Code Subagents）

1. ** ワークフローループ実行コマンド**

### 使い方
```bash
/wf タスクの説明
```

### 実行例
```bash
/wf @docs/plan.md に従ってアプリを実装し、完成させてください。
```
2. **進捗確認**
   - エージェントは 1 ステップずつ実装 → レビュー → `docs/context.md` へ反映します。
   - 完了時は設定に従い完了メッセージが表示されます。

### クイックスタート（サンプル plan.md を使って試す）

以下の手順で、このテンプレートを手元で素早く試せます。

```bash
# 1) クローン
git clone https://github.com/noricha-vr/claude-code-subagents-workflow.git
cd claude-code-subagents-workflow
# 2) サンプルの plan.md を使ってワークフローを実行
claude
#    ※ Claude Code で以下を実行してください
/wf @docs/plan.md に従ってサンプル実装を行い、docs/context.md を更新してください。

# 3) 進捗の確認
#    docs/context.md にステップ実行結果・レビュー結果が追記されます
```

補足:
- `docs/plan.md` はサンプル仕様です。自分のアプリに合わせて差し替えることで、同じワークフローを流用できます。
- 途中で停止した場合は「Step Nまで実行」と指示してください。

## ワークフローループの仕様

ワークフローでは次のループを自動反復します。

- 1. 次のステップを計画（planner）
- 2. 1ステップだけ実装（executor）
- 3. 実装をレビュー（reviewer）
- 4. 必須修正があれば修正 → 再レビュー
- 5. `docs/context.md` を更新（進捗・変更点・判定）
- 6. 完了判定。未完了なら 1 に戻る

重要原則:
- 1 回の実装 = 1 ステップのみ／各ステップ後に必ずレビュー／進捗は常に `docs/context.md` で管理

## ドキュメントの役割

- `docs/plan.md`: 要件・設計・UML・ユースケース・非機能要件などの「計画書」(実際にはこの仕様書を自分のアプリに合わせて作成したものを利用する)
 - `docs/plan.md`: 要件・設計・UML・ユースケース・非機能要件などの「計画書」。本リポジトリ同梱の `docs/plan.md` はサンプルです。自分のアプリに合わせて差し替えてください。
- `docs/context.md`: 実装ステップ、レビュー結果、修正内容、最終判定などの「進捗台帳」

運用メモ:
- 新しい決定事項やレビュー所見は必ず `docs/context.md` に追記します。
- 設計変更は `docs/plan.md` を更新し、変更理由を簡潔に残します。

## カスタマイズ

- `.claude/settings.json`
  - セッション開始時やSubagents完了時のメッセージなど、軽微なフックを定義します。(無くても動作に影響ありません)

## .claude ディレクトリの説明

- `.claude/agents/planner.md`
  - 役割: タスクを実装可能な小さなステップに分解し、順序立てて計画
  - 入力: ユーザーの指示。`docs/context.md` の現在のステップ、前回の実装・レビュー結果
  - 出力: `docs/context.md` の計画セクション更新（ステップごとの作業・対象ファイル・完了チェック）
  - ルール: 1 ステップ = 明確な作業、実装時間目安 5 分以内、対象ファイル 1-2 個

- `.claude/agents/executor.md`
  - 役割: 計画に基づいて 1 ステップのみ実装し、結果を記録
  - 入力: `docs/context.md` の現在ステップ、実装内容
  - 出力: `docs/context.md` の実装結果（変更内容・変更ファイル・備考）
  - ルール: 計画外実装をしない、エラーは報告、テスト可能な実装を心がける

- `.claude/agents/reviewer.md`
  - 役割: 直前の実装をレビューし、問題点と改善提案を提示
  - 入力: 実装されたコード、`docs/context.md` の実装結果
  - 出力: `docs/context.md` のレビュー結果（良い点・改善点・判定）
  - 特記: 合格時は `git add -A` → `git commit` を自動実行（メッセージ規約付き）

- `.claude/commands/wf.md`
  - `/wf` コマンドの使い方と内部ループ仕様を定義（Planner → Executor → Reviewer を完了まで反復）
  - 重要仕様: 1 回の実装 = 1 ステップ、各ステップ後に必ずレビュー、`docs/context.md` で進捗管理

- `.claude/settings.json`
  - セッション開始時（SessionStart）とタスク完了時（PostToolUse）の簡易フック
  - 例: セッション開始時に `/wf <タスク>` の案内、タスク完了時に完了メッセージ出力

## よくある質問（FAQ）

- **Q. どこを編集すればワークフローが変わりますか？**  
  - `.claude/commands/wf.md` を編集すると `/wf` コマンドの振る舞いを変えられます。
  - サブエージェントの振る舞いは`.claude/agents/` 配下の各エージェントのプロンプトを編集することで変えられます。

- **Q. ステップを完了しないまま止まってしまいました？**
  - `ステップNまで処理を行ってください` という指示を出すと、ステップNまで処理を行ってくれます。

## 課題・改善候補

- **所要時間**: サブエージェント呼び出しが多いため、完了まで時間を要します。
- **既存プロジェクト適用**: 0→1 の新規実装向け設計です。既存コードへの適用には `/wf` 以外の補助コマンド追加を検討してください。
- **ドキュメント更新方針**: 現在は各エージェントが `docs/context.md` と `docs/plan.md` を更新しますが、役割分担や更新タイミングの最適化余地があります。
- **テスト実行のタイミング**: 現状は最後に一括実行です。各ステップでの段階的テスト実行に変更すると品質が安定します。
- **Git 運用**: ステップごとにコミットしています。ブランチ戦略は未定義のため、チームポリシーに合わせて調整してください。
- **エージェント編成**: エージェント数の増減、テスター役の追加、補助エージェントの導入など編成最適化の余地があります。
- **検証範囲**: React を用いた小規模アプリ（ユーザー管理なし・DBなし・ローカル実行のみ・Dockerなし）で検証済みです。中規模以上への適用性は未検証です。
- **TDD ワークフロー**: TDD に寄せたループ設計も可能です。ただし、所要時間が大幅に増加する可能性があります。


このリポジトリをベースに、目的やチーム規約に合わせて最適なワークフローに拡張してください。

## ライセンス

MIT License


